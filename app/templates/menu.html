{% extends "base.html" %}
{% block content %}
{% if permisoCat is defined and permisoCat|length > 0 %}
<table cellspacing="15" style="margin: auto;"">
	<tbody>
        <tr>
	        <td width="5%">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#f4f4f4">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center">
                                <table width="100%" border="0" marginwidth="2" marginheight="2" cellspacing="2"  bgcolor="#FFFFFF">
                                    <tbody>
                                        <tr>
                                            <td align="center" bgcolor="#88CC88" class="celdalogin" height="30">
                                                Descarga de estadísticas
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="center" class="celdalogin2" valign="center">
                                                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                        <form action="" method="POST" id="selectD">
                                                            {{ form.hidden_tag() }}
                                                            <tr style="text-align: center;">
                                                                <td style="text-align: right; padding: 10px;"> {{ form.categoria.label }} </td>
                                                                <td style="text-align: left; padding: 10px;">  {{ form.categoria(**{"onchange":"actualizaSubcategoria()"}) }} </td>
                                                            </tr>
                                                            <tr style="text-align: center;">
                                                                <td style="text-align: right; padding: 10px;"> {{ form.subcategoria.label }} </td>
                                                                <td style="text-align: left; padding: 10px;">  {{ form.subcategoria }} </td>
                                                            </tr>
                                                            <tr style="text-align: center;">
                                                                <td style="text-align: right; padding: 10px;"> {{ form.anio.label }} </td>
                                                                <td style="text-align: left; padding: 10px;">  {{ form.anio }} </td>
                                                            </tr>
                                                            <tr>
                                                                <td align="center" colspan="2" class="celdalogin2" valign="top" style="padding: 10px;">{{ form.submit }}</td>
                                                            </tr>
                                                        </form>
                                                        {% if mensaje is defined %}
                                                        <tr><td>&nbsp;</td></tr>
                                                        <tr>
                                                            <td align="center" colspan="2" style="color:#FF0000">{{ mensaje }}</td>
                                                        </tr>
                                                        {% endif %}
                                                        {% for error in form.categoria.errors %}
                                                        <tr><td>&nbsp;</td></tr>
                                                        <tr>
                                                            <td align="center" colspan="2" style="color:#FF0000">{{ error }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                        {% for error in form.subcategoria.errors %}
                                                        <tr><td>&nbsp;</td></tr>
                                                        <tr>
                                                            <td align="center" colspan="2" style="color:#FF0000">{{ error }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                        {% for error in form.anio.errors %}
                                                        <tr><td>&nbsp;</td></tr>
                                                        <tr>
                                                            <td align="center" colspan="2" style="color:#FF0000">{{ error }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
		    </td>
	    </tr>
    </tbody>
</table>
{% else %}
<table cellspacing="15" style="margin: auto;"">
	<tbody>
        <tr>
	        <td width="5%">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#f4f4f4">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center">
                                <table width="100%" border="0" marginwidth="2" marginheight="2" cellspacing="2"  bgcolor="#FFFFFF">
                                    <tbody>
                                        <tr>
                                            <td align="center" bgcolor="#88CC88" class="celdalogin" height="30">
                                                Actualmente no tiene categorias asignadas
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </tbody>
</table>
{% endif %}
{% if software is defined and software|length > 0 %}
<table cellspacing="15" style="margin: auto;"">
	<tbody>
        <tr>
	        <td width="5%">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#f4f4f4">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center">
                                <table width="100%" border="0" marginwidth="2" marginheight="2" cellspacing="2" bgcolor="#FFFFFF">
                                    <tbody>
                                        <tr>
                                            <td align="center" bgcolor="#88CC88" class="celdalogin" height="30">
                                                Descarga de software OPI
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="center" class="celdalogin2" valign="top">
                                                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                        {% for n in software %}
                                                        <tr style="text-align: center;">
                                                            
                                                            <td style="text-align: left; padding: 10px; width: 10%;"> <button> <a href="{{ url_for('static', filename='software/') }}{{ n.programa }}">{{ n.nombre }}</a></button></td>
                                                            <td style="text-align: left; padding: 10px; width: 90%;"> {{ n.descripcion }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
		    </td>
	    </tr>
    </tbody>
</table>
{% endif %}
{% if material is defined and material|length > 0 %}
<table cellspacing="15" style="margin: auto;"">
	<tbody>
        <tr>
	        <td width="5%">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#f4f4f4">
                    <tbody>
                        <tr>
                            <td valign="middle" align="center">
                                <table width="100%" border="0" marginwidth="2" marginheight="2" cellspacing="2" bgcolor="#FFFFFF">
                                    <tbody>
                                        <tr>
                                            <td align="center" bgcolor="#88CC88" class="celdalogin" height="30">
                                                Material que tiene asignado.
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="center" class="celdalogin2" valign="top">
                                                
                                                        {% for n in material %}
                                                            <li>{{ n.descripcion }} marca {{ n.marca }} modelo {{ n.modelo }} con número de serie {{ n.numero_Serie }}. Observaciones: {{ n.observaciones }}.</li>
                                                        {% endfor %}
                                                    
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
		    </td>
	    </tr>
    </tbody>
</table>
{% endif %}
<script type="text/javascript" charset="utf-8">
    function actualizaSubcategoria() {
        $.ajax({
            url: '/updateSubcategoria',
            type: 'POST',
            data: $('#selectD').serialize(),
            success: function(selectOptions){
                $("#subcategoria").empty();
                for (var i = 0; i < selectOptions.length; i++){
                    $("#subcategoria").append(
                        $("<option></option>")
                        .attr("value", selectOptions[i])
                        .text(selectOptions[i])
                    );
                }
            }
        });
    };
</script>
{% endblock %}